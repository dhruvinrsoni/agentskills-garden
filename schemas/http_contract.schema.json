{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/dhruvinrsoni/agentskills-garden/schemas/http_contract.schema.json",
  "title": "AgentSkill HTTP Contract",
  "description": "Standard HTTP API contract that all skill containers must implement",
  "type": "object",
  "properties": {
    "endpoints": {
      "type": "object",
      "required": ["execute", "health", "describe"],
      "properties": {
        "execute": {
          "type": "object",
          "description": "POST /execute - Execute the skill with provided inputs",
          "required": ["method", "path", "request", "response"],
          "properties": {
            "method": {
              "const": "POST"
            },
            "path": {
              "const": "/execute"
            },
            "request": {
              "type": "object",
              "description": "Request body structure",
              "required": ["content-type", "schema"],
              "properties": {
                "content-type": {
                  "const": "application/json"
                },
                "schema": {
                  "type": "object",
                  "required": ["type", "properties"],
                  "properties": {
                    "type": {
                      "const": "object"
                    },
                    "properties": {
                      "type": "object",
                      "required": ["inputs"],
                      "properties": {
                        "inputs": {
                          "type": "object",
                          "description": "Input parameters matching skill's input schema"
                        },
                        "context": {
                          "type": "object",
                          "description": "Optional execution context (timeouts, preferences, etc.)",
                          "properties": {
                            "timeout_ms": {
                              "type": "integer",
                              "minimum": 100,
                              "default": 30000
                            },
                            "trace_id": {
                              "type": "string",
                              "description": "Distributed tracing ID"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "response": {
              "type": "object",
              "description": "Response body structure",
              "required": ["success", "error"],
              "properties": {
                "success": {
                  "type": "object",
                  "description": "Successful execution response (HTTP 200)",
                  "required": ["status_code", "schema"],
                  "properties": {
                    "status_code": {
                      "const": 200
                    },
                    "schema": {
                      "type": "object",
                      "required": ["type", "properties"],
                      "properties": {
                        "type": {
                          "const": "object"
                        },
                        "properties": {
                          "type": "object",
                          "required": ["status", "outputs"],
                          "properties": {
                            "status": {
                              "type": "string",
                              "enum": ["success"]
                            },
                            "outputs": {
                              "type": "object",
                              "description": "Output data matching skill's output schema"
                            },
                            "metadata": {
                              "type": "object",
                              "description": "Execution metadata",
                              "properties": {
                                "execution_time_ms": {
                                  "type": "integer"
                                },
                                "tokens_used": {
                                  "type": "integer"
                                },
                                "trace_id": {
                                  "type": "string"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "error": {
                  "type": "object",
                  "description": "Error response (HTTP 4xx/5xx)",
                  "required": ["status_codes", "schema"],
                  "properties": {
                    "status_codes": {
                      "type": "array",
                      "items": {
                        "type": "integer",
                        "enum": [400, 422, 500, 503]
                      },
                      "description": "400=Bad Request, 422=Validation Error, 500=Internal Error, 503=Unavailable"
                    },
                    "schema": {
                      "type": "object",
                      "required": ["type", "properties"],
                      "properties": {
                        "type": {
                          "const": "object"
                        },
                        "properties": {
                          "type": "object",
                          "required": ["status", "error"],
                          "properties": {
                            "status": {
                              "type": "string",
                              "enum": ["error"]
                            },
                            "error": {
                              "type": "object",
                              "required": ["code", "message"],
                              "properties": {
                                "code": {
                                  "type": "string",
                                  "examples": [
                                    "INVALID_INPUT",
                                    "VALIDATION_ERROR",
                                    "INTERNAL_ERROR",
                                    "TIMEOUT",
                                    "DEPENDENCY_UNAVAILABLE"
                                  ]
                                },
                                "message": {
                                  "type": "string"
                                },
                                "details": {
                                  "type": "object"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "health": {
          "type": "object",
          "description": "GET /health - Liveness and readiness check",
          "required": ["method", "path", "response"],
          "properties": {
            "method": {
              "const": "GET"
            },
            "path": {
              "const": "/health"
            },
            "response": {
              "type": "object",
              "required": ["schema"],
              "properties": {
                "schema": {
                  "type": "object",
                  "required": ["type", "properties"],
                  "properties": {
                    "type": {
                      "const": "object"
                    },
                    "properties": {
                      "type": "object",
                      "required": ["status"],
                      "properties": {
                        "status": {
                          "type": "string",
                          "enum": ["healthy", "degraded", "unhealthy"]
                        },
                        "version": {
                          "type": "string",
                          "description": "Skill version"
                        },
                        "uptime_seconds": {
                          "type": "integer"
                        },
                        "checks": {
                          "type": "object",
                          "description": "Individual health check results",
                          "patternProperties": {
                            ".*": {
                              "type": "object",
                              "properties": {
                                "status": {
                                  "type": "string",
                                  "enum": ["pass", "warn", "fail"]
                                },
                                "message": {
                                  "type": "string"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "describe": {
          "type": "object",
          "description": "GET /describe - Return the skill's schema definition",
          "required": ["method", "path", "response"],
          "properties": {
            "method": {
              "const": "GET"
            },
            "path": {
              "const": "/describe"
            },
            "response": {
              "type": "object",
              "required": ["schema"],
              "properties": {
                "schema": {
                  "type": "object",
                  "description": "Returns the full skill schema (schemas/skill.schema.json format)",
                  "required": ["type"],
                  "properties": {
                    "type": {
                      "const": "object"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "required": ["endpoints"]
}
