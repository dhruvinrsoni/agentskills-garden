{
  "$schema": "../../schemas/skill.schema.json",
  "id": "map_dependencies",
  "name": "Map Dependencies",
  "version": "0.1.0",
  "level": 1,
  "domain": "code_understanding",
  "description": {
    "short": "Traces and maps imports, dependencies, and module relationships in codebases.",
    "long": "Analyzes code to identify all dependencies including imports, package references, and module relationships. Creates a dependency graph showing how files and modules are connected. Supports multiple languages and can identify both internal (project) and external (library) dependencies. Part of Gap #3: Understanding Legacy Code."
  },
  "interface": {
    "inputs": {
      "source_path": {
        "type": "string",
        "description": "Path to file or directory to analyze",
        "required": true
      },
      "language": {
        "type": "string",
        "description": "Programming language (auto-detected if not specified)",
        "required": false,
        "enum": ["python", "javascript", "typescript", "java", "go", "auto"]
      },
      "depth": {
        "type": "integer",
        "description": "How deep to trace dependencies (1=direct only, -1=unlimited)",
        "default": 3,
        "minimum": -1
      },
      "include_external": {
        "type": "boolean",
        "description": "Whether to include external/third-party dependencies",
        "default": true
      },
      "output_format": {
        "type": "string",
        "description": "Output format for dependency information",
        "enum": ["summary", "graph", "tree", "detailed"],
        "default": "summary"
      }
    },
    "outputs": {
      "summary": {
        "type": "string",
        "description": "Human-readable summary of dependencies"
      },
      "total_dependencies": {
        "type": "integer",
        "description": "Total count of all dependencies found"
      },
      "internal_dependencies": {
        "type": "array",
        "description": "List of internal/project dependencies",
        "items": {
          "type": "object",
          "properties": {
            "source": {"type": "string", "description": "Source file/module"},
            "target": {"type": "string", "description": "Dependency file/module"},
            "import_type": {"type": "string", "description": "Type of import (direct, from, namespace)"},
            "symbols": {"type": "array", "description": "Imported symbols/names", "items": {"type": "string"}}
          }
        }
      },
      "external_dependencies": {
        "type": "array",
        "description": "List of external/library dependencies",
        "items": {
          "type": "object",
          "properties": {
            "name": {"type": "string", "description": "Package/library name"},
            "used_in": {"type": "array", "description": "Files using this dependency", "items": {"type": "string"}},
            "import_count": {"type": "integer", "description": "Number of times imported"}
          }
        }
      },
      "dependency_graph": {
        "type": "object",
        "description": "Graph representation of dependencies",
        "properties": {
          "nodes": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {"type": "string"},
                "type": {"type": "string", "enum": ["internal", "external"]},
                "path": {"type": "string"}
              }
            }
          },
          "edges": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "source": {"type": "string"},
                "target": {"type": "string"},
                "weight": {"type": "integer"}
              }
            }
          }
        }
      },
      "circular_dependencies": {
        "type": "array",
        "description": "Detected circular dependency chains",
        "items": {
          "type": "array",
          "items": {"type": "string"}
        }
      },
      "entry_points": {
        "type": "array",
        "description": "Files with no incoming dependencies (potential entry points)",
        "items": {"type": "string"}
      },
      "highly_depended": {
        "type": "array",
        "description": "Files that many others depend on (core modules)",
        "items": {
          "type": "object",
          "properties": {
            "path": {"type": "string"},
            "dependents_count": {"type": "integer"}
          }
        }
      }
    },
    "context_required": ["project_structure", "package_manifest"]
  },
  "dependencies": ["summarize_code"],
  "validation": {
    "test_cases": [
      {
        "name": "python_simple_imports",
        "input": {
          "source_path": "sample.py",
          "language": "python"
        },
        "expected_behavior": "Should detect import and from...import statements"
      },
      {
        "name": "javascript_requires",
        "input": {
          "source_path": "sample.js",
          "language": "javascript"
        },
        "expected_behavior": "Should detect require() and import statements"
      },
      {
        "name": "empty_file",
        "input": {
          "source_path": "empty.py",
          "language": "python"
        },
        "expected_behavior": "Should return empty dependency lists with summary"
      },
      {
        "name": "circular_detection",
        "input": {
          "source_path": "circular_project/",
          "language": "python"
        },
        "expected_behavior": "Should identify circular dependency chains"
      }
    ],
    "invariants": [
      "total_dependencies >= len(internal_dependencies) + len(external_dependencies)",
      "All graph nodes must have corresponding entries in dependency lists",
      "Circular dependencies should only contain internal dependencies"
    ]
  },
  "metadata": {
    "author": "agentskills-garden",
    "tags": ["dependency", "imports", "modules", "graph", "analysis"],
    "changelog": [
      {
        "version": "0.1.0",
        "date": "2025-01-20",
        "changes": ["Initial implementation with Python and JavaScript support"]
      }
    ]
  }
}
